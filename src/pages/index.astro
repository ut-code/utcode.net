---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import { Focus } from "../schema.ts";

import ActionButton from "../components/ActionButton.astro";
import SectionHeader from "../components/per-page/SectionHeader.astro";
import GlobalLayout from "../layouts/GlobalLayout.astro";
import ProjectList from "../components/ProjectList.astro";
import ArticleList from "../components/ArticleList.astro";

import Hero from "../images/hero.jpg";
import LabCafe from "../images/lab-cafe.jpg";
import LogoGMOMedia from "../images/logo-gmo-media.png";

const projects = (await getCollection("projects"))
  .sort((a, b) => {
    const a_order = a.data.order ?? Number.POSITIVE_INFINITY,
      b_order = b.data.order ?? Number.POSITIVE_INFINITY;
    if (a_order !== b_order) {
      return a_order - b_order;
    }
    return b.data.date.getTime() - a.data.date.getTime();
  })
  .slice(0, 6);
const articles = (await getCollection("articles"))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 6);
---

<GlobalLayout title={null} description={null} focus={Focus.none}>
  <div
    class="h-screen grid grid-flow-col"
    style={{ gridTemplateRows: "max-content minmax(0, 1fr)" }}
  >
    <div style={{ gridArea: "2 / 1" }}>
      <Image
        alt="活動の様子"
        class="w-full h-full object-cover"
        width="1920"
        height="1080"
        src={Hero}
      />
    </div>
    <div
      class="relative bg-black/20 flex items-center"
      style={{ gridArea: "2 / 1" }}
    >
      <div class="container mx-auto px-4">
        <div class="bg-white max-w-lg p-8">
          <h1 class="text-2xl md:text-3xl">
            <span class="inline-block">東京大学の</span>
            <span class="inline-block">ソフトウェア開発</span>
            <span class="inline-block">コミュニティ</span>
          </h1>
          <div class="prose mt-3">
            <p>
              ut.code(); は、2019
              年発足の東京大学のソフトウェアエンジニアリングコミュニティ・プログラミングサークルです。
              プログラミングの学習から、実社会で役立つソフトウェア製作まで、幅広い活動を行っています。
            </p>
          </div>
          <ActionButton to="/join/" class="mt-4"> JOIN US </ActionButton>
        </div>
      </div>
    </div>
  </div>
  <section class="bg-gray-100">
    <div class="container mx-auto px-4 py-12">
      <SectionHeader title="Activities" subtitle="活動内容" />
      <div class="mt-8 p-6 md:p-8 bg-white rounded-xl">
        <ul class="flex flex-col gap-12 lg:flex-row">
          {
            [
              {
                key: "learn",
                title: "学習",
                description:
                  "プログラミングに初めて取り組む皆さんに向け、学習会を開催しています。また、初心者からでも実際にサービスを開発できるよう、学習カリキュラムをオープンソースで公開しています。",
                icon: "feather:book-open",
              },
              {
                key: "share",
                title: "交流",
                description:
                  "定期的なイベントの開催により、メンバー同士の交流を深めています。集中して開発を行う合宿や、新しいサービス開発のアイデアを出し合うブレインストーミング大会などを行っています。",
                icon: "feather:message-square",
              },
              {
                key: "develop",
                title: "開発",
                description:
                  "大学や社会をより良くするソフトウェアを一緒に開発しましょう。切磋琢磨した仲間はかけがえのないものになるはずです。開発したソフトウェアの多くは GitHub で公開しています。",
                icon: "feather:box",
              },
            ].map((activity) => (
              <li class="lg:flex-1">
                <div class="w-max p-2 bg-black text-white rounded-md">
                  <Icon name={activity.icon} class="w-6 h-6" />
                </div>
                <h3 class="mt-3 text-2xl">{activity.title}</h3>
                <div class="mt-2">
                  <p class="prose max-w-none">{activity.description}</p>
                </div>
                <a
                  class="mt-2 flex items-center gap-1 hover:underline"
                  href={`/activities/${activity.key}/`}
                >
                  <span>Learn more</span>
                  <Icon name="feather:arrow-right" class="w-4 h-4" />
                </a>
              </li>
            ))
          }
        </ul>
      </div>
    </div>
  </section>
  <section>
    <iframe
      title="ut.code(); 紹介動画"
      class="w-full h-[200px] sm:h-[300px] md:h-[400px] lg:h-[600px]"
      src="https://www.youtube-nocookie.com/embed/aUoa1AyfbMA?rel=0"
      allow="picture-in-picture; web-share"
      allow-fullscreen></iframe>
  </section>
  <section>
    <div class="container mx-auto px-4 py-12">
      <SectionHeader title="Projects" subtitle="実施中のプロジェクト" />
      <ProjectList class="mt-10" {projects} />
      <ActionButton to="/projects/" class="mt-8 ml-auto">
        すべてのプロジェクト
      </ActionButton>
    </div>
  </section>
  <section class="bg-black text-white py-12">
    <div class="container mx-auto px-8 flex gap-12 items-center">
      <div class="flex-grow self-center">
        <h1 class="text-4xl leading-snug">
          <span class="inline-block mb-3">未来の<wbr />ソフトウェアを</span>
          <br />
          <span>デザインしよう</span>
        </h1>
        <p class="mt-3 text-gray-300 leading-loose">
          <span class="inline-block">
            ut.code(); で一緒にワクワクするソフトウェアを作りませんか？
          </span>
          <span class="inline-block">
            初心者から実務経験者、学年を問わずどなたでも大歓迎です。
          </span>
        </p>
        <ActionButton to="/join/" variant="dark" class="mt-8">
          JOIN US
        </ActionButton>
      </div>
      <div class="hidden lg:block self-stretch flex-shrink">
        <Image
          alt="背景"
          src={LabCafe}
          width="600"
          height="400"
          class="w-full h-full object-cover rounded-3xl overflow-clip"
        />
      </div>
    </div>
  </section>
  <section>
    <div class="container mx-auto px-4 py-12">
      <SectionHeader title="News" subtitle="最新情報" />
      <ArticleList variant="compact" class="mt-10" {articles} />
      <ActionButton to="/articles" class="mt-8 ml-auto">
        すべての記事
      </ActionButton>
    </div>
  </section>
  <section class="bg-gray-100">
    <div class="container mx-auto py-12">
      <SectionHeader title="About us" subtitle="団体概要" />
      <ul class="grid lg:grid-cols-2 gap-x-8 mt-8 text-lg text-gray-800">
        {
          [
            { title: "団体名", content: "ut.code();" },
            { title: "構成人数", content: "20 名程度 (アクティブ)" },
            { title: "部室", content: "駒場キャンパス学生会館 313B 教室" },
            {
              title: "X",
              content: "@utokyo_code",
              link: "https://x.com/utokyo_code",
            },
            {
              title: "活動場所",
              content: "オンライン, 部室, KOMAD, その他施設",
            },
            { title: "所属", content: "東京大学工学部丁友会 (2022 年度)" },
          ].map(({ title, content, link }) => (
            <li class="flex gap-4 border-b border-gray-400 px-6 py-3">
              <div class="w-24">{title}</div>
              {link ? (
                <a
                  href={link}
                  target="_blank"
                  rel="noreferrer"
                  class="flex-1 text-blue-500 underline"
                >
                  {content}
                </a>
              ) : (
                <div class="flex-1">{content}</div>
              )}
            </li>
          ))
        }
      </ul>
    </div>
  </section>
  <section>
    <div class="container mx-auto px-8 py-12">
      <SectionHeader title="協賛企業様" />
      <div class="flex flex-wrap justify-center items-center mt-8 gap-4">
        <Image
          alt="GMOメディア株式会社"
          src={LogoGMOMedia}
          width="400"
          height="600"
        />
      </div>
    </div>
  </section>
  <section class="bg-gray-100">
    <div class="container mx-auto px-8 py-12">
      <SectionHeader title="ご寄付のお願い" />
      <div class="prose max-w-none mt-8 text-center">
        <p>
          <span class="inline-block">
            現在、ut.code(); の活動費は寄付によって賄われています。
          </span>
          <span class="inline-block">
            弊団体の継続的な活動のため、ぜひご寄付にご協力ください。
          </span>
        </p>
      </div>
      <ActionButton to="/donation/" class="mt-8 mx-auto">
        寄付する
      </ActionButton>
    </div>
  </section>
</GlobalLayout>
