---
import type { GetStaticPaths } from "astro";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";

import { Focus, type Project } from "../../schema";
import GlobalLayout from "../../layouts/GlobalLayout.astro";
import JoinUsCTA from "../../components/JoinUsCTA.astro";
import ActionButton from "../../components/ActionButton.astro";
import { getCollection } from "astro:content";
import { render } from "astro:content";

export const getStaticPaths = (async () => {
  const projects = await getCollection("projects");
  return projects.map((project) => ({
    params: { project: project.id },
    props: { project },
  }));
}) satisfies GetStaticPaths;
const { project } = Astro.props;
const { Content } = await render(project);
---

<!--- TODO: truncate project.body -->
<GlobalLayout
  title={project.data.title}
  description={project.data.description}
  focus={Focus.projects}
>
  <main>
    <div
      class="lg:mx-auto lg:flex lg:max-w-screen-lg lg:flex-row-reverse lg:items-center lg:gap-4 lg:px-4 lg:py-12"
    >
      <Image
        class="h-64 w-full md:h-96 lg:h-[400px] lg:w-[600px] lg:rounded-2xl"
        alt="プロジェクト画像"
        src={project.data.image}
      />
      <div class="container mx-auto mt-8 px-4 lg:mx-0 lg:flex-1">
        <p class="flex items-center gap-1 text-gray-600">
          <Icon name="feather:layers" />
          <span>Project</span>
        </p>
        <h1 class="mt-2 text-3xl lg:text-5xl">
          {project.data.title}
        </h1>
        {
          project.data.tags && (
            <ul class="mt-4 flex flex-wrap gap-2 lg:mt-6">
              {project.data.tags.map((tag: string) => (
                <li class="rounded-full border border-current px-3 text-sm leading-relaxed lg:text-base">
                  {tag}
                </li>
              ))}
            </ul>
          )
        }
        {
          /* 表示する icon が無いときは、親要素の高さの分間隔が広くなりすぎるので、親要素ごと表示しないようにする。 */
        }
        {
          (project.data.github || project.data.youtube) && (
            <>
              <div class="mt-6 flex gap-4 text-4xl">
                {project.data.github && (
                  <a
                    href={project.data.github}
                    target="_blank"
                    class="-m-1 rounded-xl p-1 hover:bg-gray-100"
                    rel="noreferrer"
                    aria-label="GitHubを見る"
                  >
                    <Icon name="feather:github" />
                  </a>
                )}
              </div>
              {project.data.youtube && (
                <a
                  href={project.data.youtube}
                  target="_blank"
                  class="-m-1 rounded-xl p-1 hover:bg-gray-100"
                  rel="noreferrer"
                  aria-label="YouTubeを見る"
                >
                  <Icon name="feather:youtube" />
                </a>
              )}
            </>
          )
        }
        {
          project.data.website && (
            <ActionButton to={project.data.website} class="my-6">
              <Icon name="feather:globe" class="mr-2 inline-block h-6 w-6" />
              <span>{project.data.title} へ</span>
            </ActionButton>
          )
        }
      </div>
    </div>
    <div class="container mx-auto mt-6 px-4 lg:max-w-screen-lg">
      <div class="prose max-w-none rounded-lg bg-gray-100 p-4">
        {project.data.description}
      </div>
      <div class="prose mt-8 max-w-none"><Content /></div>
      <JoinUsCTA class="mt-8">
        ut.code(); で{project.data.title}を開発しませんか？
      </JoinUsCTA>
    </div>
  </main>
</GlobalLayout>
