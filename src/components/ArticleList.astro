---
import { format } from "date-fns";
import noImage from "../images/no-image.svg";
import type { Article } from "../schema";
import { Image } from "astro:assets";

interface Props {
  variant?: "normal" | "compact";
  articles: { data: Article; body?: string }[];
  class?: string;
}
const props = Astro.props;
const { variant = "normal", articles } = props;
---

<!--
  fragment ArticleListArticle on Mdx {
    id
    frontmatter {
      date
      slug
      title
      image {
        childImageSharp {
          gatsbyImageData(
            width: 600
            height: 400
            transformOptions: { fit: INSIDE }
          )
          largeGatsbyImageData: gatsbyImageData(
            width: 1200
            height: 800
            transformOptions: { fit: INSIDE }
          )
        }
      }
    }
    excerpt(pruneLength: 60)
    longExcerpt: excerpt(pruneLength: 200)
  }
-->
<ul
  class:list={[
    "grid grid-flow-dense gap-9 md:grid-cols-2 lg:grid-cols-3",
    variant === "normal" && "xl:grid-cols-4",
    props.class,
  ]}
>
  {
    articles.map((article, i) => {
      const isFeatured = variant === "normal" && i % 11 === 0; // 11 記事ごとに大きく表示する
      const additionalProps = isFeatured
        ? {
            cellClassName: "md:col-span-2 md:row-span-2",
            imageClassName: "h-[350px] md:h-[450px]",
            excerpt: article.body?.slice(0, 120),
          }
        : {
            cellClassName: "",
            imageClassName: "h-[200px]",
            excerpt: article.body?.slice(0, 120),
          };
      return (
        <li class="contents">
          <a
            href={`/articles/${article.data.slug}`}
            class:list={[
              "block hover:opacity-80",
              additionalProps.cellClassName,
            ]}
          >
            <div
              class:list={[
                "isolate h-48 w-full overflow-clip rounded-xl object-cover",
                additionalProps.imageClassName,
              ]}
            >
              <Image
                alt="カバー画像"
                height={48 * 4 * 4}
                width={48 * 4 * 4}
                src={article.data.image}
                class="h-full w-full object-cover"
              />
            </div>
            <div class="mt-4">
              <time class="block text-sm text-gray-500">
                {format(article.data.date, "yyyy/MM/dd HH:mm")}
              </time>
              <h3 class="text-lg font-bold">{article.data.title}</h3>
              <p class="prose mt-2 max-w-none">{additionalProps.excerpt}</p>
            </div>
          </a>
        </li>
      );
    })
  }
</ul>
